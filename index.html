<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weed Strain Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <style>
    @keyframes smokeRise {
      0% {
        opacity: 0.9;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-200px) scale(2);
      }
    }

    .smoke {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, #88ff88 20%, transparent);
      border-radius: 50%;
      animation: smokeRise 2.5s ease-out forwards;
      z-index: 50;
      pointer-events: none;
    }

    .joint {
      position: fixed;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 20px;
      background: linear-gradient(to right, white, gray);
      border-radius: 10px;
      z-index: 49;
      box-shadow: 0 0 5px #0f0;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen px-4 py-8">
  <h1 class="text-4xl font-bold text-green-400 text-center mb-8">Weed Strain Tracker</h1>

  <form id="strain-form" class="bg-gray-800 max-w-md mx-auto p-6 rounded-lg shadow-lg">
    <label class="block mb-2">Strain Name:</label>
    <input type="text" id="name" required class="w-full p-2 rounded bg-gray-700 text-white mb-2" placeholder="Strain Name" />
    <div class="flex items-center mb-4 space-x-2">
      <button type="button" id="lookup-leafly" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-black font-semibold">Leafly üîç</button>
      <button type="button" id="lookup-seedsman" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-black font-semibold">Seedsman üîç</button>
    </div>
    <label class="block mb-2">Type (Indica, Sativa, Hybrid):</label>
    <input type="text" id="type" required class="w-full p-2 rounded bg-gray-700 mb-4" />
    <label class="block mb-2">Description:</label>
    <textarea id="description" required class="w-full p-2 rounded bg-gray-700 mb-4" rows="3"></textarea>
    <label class="block mb-2">Notes:</label>
    <textarea id="notes" class="w-full p-2 rounded bg-gray-700 mb-4" rows="2" placeholder="Optional notes..."></textarea>
    <button type="submit" class="bg-green-500 hover:bg-green-600 text-black font-bold w-full py-2 rounded">Add Strain</button>
    <button id="find-near-me" type="button" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">üìç Find Dispensaries Near Me
    </button>
  </form>

  <div id="smoke-container"></div>

  <script>
    document.getElementById('find-near-me').addEventListener('click', () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const query = `https://www.google.com/maps/search/dispensary/@${lat},${lon},14z`;
          window.open(query, '_blank');
        }, () => alert("Unable to access location."));
      } else {
        alert("Geolocation not supported.");
      }
    });

    const form = document.getElementById('strain-form');
    const smokeContainer = document.getElementById('smoke-container');

    function showSmokeAnimation() {
      const joint = document.createElement('div');
      joint.className = 'joint';
      smokeContainer.appendChild(joint);

      const smoke = document.createElement('div');
      smoke.className = 'smoke';
      smokeContainer.appendChild(smoke);

      setTimeout(() => {
        joint.remove();
        smoke.remove();
      }, 2500);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = form.name.value.trim();
      const type = form.type.value.trim();
      const description = form.description.value.trim();
      const notes = form.notes.value.trim();
      if (!name || !type || !description) return;

      await firebase.firestore().collection('strains').add({ name, type, description, notes, rating: 0 });
      form.reset();
      showSmokeAnimation();
    });
  </script>
</body>
</html>
